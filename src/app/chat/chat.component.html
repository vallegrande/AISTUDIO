<div class="chat-container">
    <!-- Bot贸n Toggle (Siempre visible) -->
    <div class="toggle-btn-container">
        <button class="toggle-btn" (click)="togglePanel()">
            <mat-icon>menu</mat-icon> <!-- Icono de toggle -->
        </button>
    </div>
    <!-- Panel de Conversaciones -->
    <div class="conversations-panel" [class.hidden]="isMinimized">
        <div class="conv_encabe">
            <button class="new-conversation-btn" (click)="addConversation()">
                <mat-icon>maps_ugc</mat-icon> <!-- Icono de nueva conversaci贸n -->
            </button>
        </div>
        <!-- Navegaci贸n de Conversaciones -->
        <div class="conversation-nav">
            <button (click)="filterConversations('active')" [class.active]="filter === 'active'">Activos</button>
            <button (click)="filterConversations('inactive')" [class.active]="filter === 'inactive'">Inactivos</button>
        </div>
        <div class="historial">
            <ul class="conversation-list">
                <li *ngFor="let conversation of filteredConversations" class="conversation-item">
                    <div class="conversation-content" (click)="selectConversation(conversation)">
                        <span class="conversation-topic"
                            *ngIf="!isEditing || (isEditing && selectedConversation.conversationId !== conversation.conversationId)">
                            {{ conversation.topic }}
                        </span>
                        <input *ngIf="isEditing && selectedConversation.conversationId === conversation.conversationId"
                            [(ngModel)]="editedConversationName" (keyup.enter)="saveUpdatedConversation()"
                            (blur)="cancelEdit()" class="edit-input" /> <!-- Input para editar el nombre -->
                    </div>
                    <div class="more_vert">
                        <button mat-icon-button [matMenuTriggerFor]="menu" (click)="stopPropagation($event)">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button mat-menu-item *ngIf="conversation.active && filter !== 'inactive'"
                                (click)="updateConversation(conversation)">
                                <mat-icon>edit</mat-icon> Cambiar el nombre
                            </button>
                            <button mat-menu-item *ngIf="conversation.active && filter !== 'inactive'"
                                (click)="archive(conversation)">
                                <mat-icon>archive</mat-icon> Archivar
                            </button>
                            <button mat-menu-item *ngIf="conversation.active && filter !== 'inactive'"
                                (click)="deleteConversation(conversation)" style="color: rgb(201, 0, 0);">
                                <mat-icon style="color: rgb(201, 0, 0);">delete</mat-icon> Eliminar
                            </button>
                            <button mat-menu-item *ngIf="conversation.active !== 'A' && filter === 'inactive'"
                                (click)="desarchive(conversation)">
                                <mat-icon>unarchive</mat-icon> Desarchivar
                            </button>
                        </mat-menu>
                    </div>
                </li>
            </ul>
            <div *ngIf="filteredConversations.length === 0" class="no-conversations">
                No hay conversaciones {{ filter === 'inactive' ? 'inactivas' : 'activas' }}
            </div>
        </div>
    </div>
    <!-- Panel de Chat -->
    <div class="chat-panel">
        <div *ngIf="!selectedConversation" class="center">
            <div class="bienvenida">
                <h1 class="styled-title">Bienvenido a GeminiChat, selecciona o crea una conversaci贸n para empezar.</h1>
            </div>
        </div>
        <div *ngIf="selectedConversation" class="chat-content">
            <h2>{{ selectedConversation.topic }}</h2>
            <!-- Lista de mensajes (ahora desplazable) -->
            <div class="message-list">
                <div *ngFor="let message of messages">
                    <!-- Mensaje de Usuario -->
                    <div class="message user-message">
                        <div class="message-content">
                            <strong>Usuario:</strong> {{ message.question }}
                        </div>
                        <div class="message-circle user-circle">U</div>
                    </div>
                    <!-- Respuesta del sistema -->
                    <div class="message system-message">
                        <div class="message-circle system-circle">IA</div>
                        <div class="message-content">
                            <strong>Respuesta:</strong> {{ message.answer }}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Input para nuevo mensaje -->
            <div class="new-message">
                <textarea [(ngModel)]="newMessage" placeholder="Escribe tu mensaje..." (input)="onMessageInput()"
                    (keydown)="onKeyDown($event)" rows="3"></textarea>
                <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()"
                    [ngStyle]="{'opacity': newMessage ? '1' : '0.5'}">
                    <mat-icon>send</mat-icon>
                </button>
            </div>
        </div>
    </div>
</div>